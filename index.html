<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캐릭터 관계도 생성기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            overflow: hidden; /* 스크롤 방지 */
        }
        /* 커스텀 스크롤바 (사이드바용) */
        #sidebar {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        #sidebar::-webkit-scrollbar {
            width: 8px;
        }
        #sidebar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        #sidebar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
            border: 2px solid #f1f5f9;
        }
        /* 선택된 관계 항목 스타일 */
        .legend-item.active {
            box-shadow: 0 0 0 3px #3b82f6; /* 파란색 테두리 */
            background-color: #eff6ff; /* 연한 파란색 배경 */
        }
    </style>
</head>
<body class="flex h-screen bg-gray-100 text-gray-800">

    <input type="file" id="importJsonInput" accept="application/json" class="hidden">

    <div id="nodeModal" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
            <h3 class="text-xl font-semibold mb-4">새 캐릭터 추가</h3>
            <div class="space-y-4">
                <div>
                    <label for="nodeNameInput" class="block text-sm font-medium text-gray-700">캐릭터 이름</label>
                    <input type="text" id="nodeNameInput" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="이름 입력...">
                </div>
                <div>
                    <label for="nodeImageInput" class="block text-sm font-medium text-gray-700">캐릭터 이미지 (선택)</label>
                    <input type="file" id="nodeImageInput" accept="image/*" class="mt-1 block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-blue-50 file:text-blue-700
                        hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">이미지 미선택 시 단색원으로 표시됩니다.</p>
                </div>
                <div>
                    <label for="nodeColorInput" class="block text-sm font-medium text-gray-700">단색원 색상 (이미지 미선택 시)</label>
                    <input type="color" id="nodeColorInput" value="#cbd5e1" class="mt-1 block w-full h-10 border-gray-300 rounded-md">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelAddNode" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    취소
                </button>
                <button id="confirmAddNode" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    추가하기
                </button>
            </div>
        </div>
    </div>

    <div id="sidebar" class="w-80 h-full bg-white shadow-lg flex flex-col p-5 overflow-y-auto">
        <h1 class="text-2xl font-bold text-blue-600 mb-2">관계도 생성기</h1>
        <p class="text-xs text-gray-500 mb-6">Original Image by X@P2_PVP</p>
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-3 border-b pb-2">관계 정의</h2>
            <div class="space-y-3">
                <input type="text" id="legendText" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="관계 이름 (예: 친구)">
                <input type="color" id="legendColor" value="#ff0000" class="w-full h-10 border-gray-300 rounded-md">
                <button id="addLegendBtn" class="w-full py-2 px-4 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors">
                    관계 추가
                </button>
            </div>
            <div id="legendDisplay" class="mt-4 space-y-2">
                </div>
        </div>

        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-3 border-b pb-2">캐릭터</h2>
            <button id="addNodeBtn" class="w-full py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors">
                새 캐릭터 추가
            </button>
            <div id="characterDisplay" class="mt-4 space-y-2">
                </div>
        </div>

        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-3 border-b pb-2">도구</h2>
            <div class="space-y-3">
                <button id="arrangeCircleBtn" class="w-full py-2 px-4 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-colors">
                    원형으로 정렬
                </button>
                <button id="exportBtn" class="w-full py-2 px-4 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 transition-colors">
                    PNG로 저장
                </button>
                <button id="exportJsonBtn" class="w-full py-2 px-4 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
                    JSON으로 내보내기
                </button>
                <button id="importJsonBtn" class="w-full py-2 px-4 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
                    JSON에서 가져오기
                </button>
                <button id="clearBtn" class="w-full py-2 px-4 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                    전체 초기화
                </button>
            </div>
        </div>
        
        <div class="mt-auto pt-4 border-t">
            <h3 class="font-semibold">안내</h3>
            <p id="statusArea" class="text-sm text-gray-600 leading-relaxed">
                '관계 추가'로 관계를 정의하고 '새 캐릭터 추가'로 캐릭터를 만드세요.<br>
                관계를 그리려면: [정의된 관계] 클릭 → [캐릭터 1] 클릭 → [캐릭터 2] 클릭
            </p>
        </div>
    </div>

    <div class="flex-grow p-5 h-full">
        <canvas id="mainCanvas" class="w-full h-full bg-white rounded-lg shadow-inner border border-gray-200">
            캔버스를 지원하지 않는 브라우저입니다.
        </canvas>
    </div>

    <script type="module" src="main.js"></script>

</body>
</html>
